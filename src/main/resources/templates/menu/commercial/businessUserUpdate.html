<!DOCTYPE html>
<html style="overflow-x:auto;overflow-y:auto;">
<head>
    <title>商户信息管理 - Powered By JeeSite</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="author" content="http://jeesite.com/"/>
    <meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10" />
    <meta http-equiv="Expires" content="0"><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Cache-Control" content="no-store">
    <script src="../../../static/static/jquery/jquery-1.8.3.min.js" type="text/javascript"
    th:src="@{../static/jquery/jquery-1.8.3.min.js}"></script>
    <link href="../../../static/static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet"
    th:href="@{../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css}"/>
    <script src="../../../static/static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"
    th:src="@{../static/bootstrap/2.3.1/js/bootstrap.min.js}"></script>
    <link href="../../../static/static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet"
    th:href="@{../static/bootstrap/2.3.1/awesome/font-awesome.min.css}"/>
    <link href="../../../static/static/jquery-select2/3.4/select2.min.css" rel="stylesheet"
    th:href="@{../static/jquery-select2/3.4/select2.min.css}"/>
    <script src="../../../static/static/jquery-select2/3.4/select2.min.js" type="text/javascript"
    th:src="@{../static/jquery-select2/3.4/select2.min.js}"></script>
    <link href="../../../static/static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet"
    th:href="@{../static/jquery-validation/1.11.0/jquery.validate.min.css}"/>
    <script src="../../../static/static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"
    th:src="@{../static/jquery-validation/1.11.0/jquery.validate.min.js}"></script>
    <link href="../../../static/static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet"
    th:href="@{../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css}"/>
    <script src="../../../static/static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"
    th:src="@{../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js}"></script>
    <script src="../../../static/static/My97DatePicker/WdatePicker.js" type="text/javascript"
    th:src="@{../static/My97DatePicker/WdatePicker.js}"></script>
    <script src="../../../static/static/common/mustache.min.js" type="text/javascript"
    th:src="@{../static/common/mustache.min.js}"></script>
    <link href="../../../static/static/common/jeesite.css" type="text/css" rel="stylesheet"
    th:href="@{../static/common/jeesite.css}"/>
    <script src="../../../static/static/common/jeesite.js" type="text/javascript"
    th:src="@{../static/common/jeesite.js}"></script>
    <script type="text/javascript">var ctx = '/a', ctxStatic='/static';</script>
    <meta name="decorator" content="default"/>
    <link rel="stylesheet" href="../../../static/static/jquery-ui/ui.css"
    th:href="@{../static/jquery-ui/ui.css}">
    <script src="../../../static/static/jquery-ui/ui.js"
    th:src="@{../static/jquery-ui/ui.js}"></script>
    <script type="text/javascript" src="../../../static/static/jquery-tmpl/template.js"
    th:src="@{../static/jquery-tmpl/template.js}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#channelStatus-1").change(function () {
                if($(this).val()=="Y"){
                    $.ajax({
                        type:"get",
                        url:"/brcd/wechatTrade/findWechatTrade",
                        dataType : "json",
                        success:function(data){
                            $.each(data, function(i, wechatTrades) {
                                var $option = '<option  value='+wechatTrades.tradeName+'>'+wechatTrades.tradeName+'</option>';
                                $('#channelBusinessType-1').append($option);
                            });
                        }
                    });
                    $('#channelStatus-3').prop("disabled", true);
                }else{
                    $('#channelStatus-3').prop("disabled", false);
                }
            })
            $("#channelStatus-3").change(function () {
                if($(this).val()=="Y"){
                    $.ajax({
                        type:"get",
                        url:"/brcd/AlipayTrade/findAlipayTrade",
                        dataType : "json",
                        success:function(data){
                            $.each(data, function(i, alipayTrade) {
                                var $option = '<option  value='+alipayTrade.firstType+'>'+alipayTrade.firstType+'</option>';
                                $('#channelBusinessType-3').append($option);
                            });
                        }
                    });
                    $('#channelStatus-1').prop("disabled", true);
                }else{
                    $('#channelStatus-1').prop("disabled", false);
                }
            })
            //判断当前商户是否有信息变更在审核中
            $.ajax({
                type:"post",
                url:"/a/operate/customer/brcbCustomerCheck/isCustomerChanging?",
                dataType : "json",
                data: {customerNum:$("#customerNum").val()},
                success:function(data){
                    if(data.success == 'false'){
                        window.top.openDialog("抱歉：当前商户已经申请信息变更，正在审核中，此期间禁止修改操作！");
                        $(".form-actions").remove();
                    }
                }
            });


            //异步加载审核意见
            $.ajax({
                type:"post",
                url:"/a/operate/customer/brcbCustomer/getCustomerAudit?",
                dataType : "json",
                data: {customerNum:$("#customerNum").val()},
                success:function(data){
                    $('#auditInfo').html(template('auditRecordTemplate', data));
                }
            });

            //初始化 代理商名称
            $.ajax({
                type:"get",
                url:"/a/operate/agent/getByNum?",
                data:{agentNum:$("#agentNum").html()},
                dataType : "json",
                success:function(data){

                    $("#agentName").html(data.agent.fullName);

                    //判断是否开通T+0
                    var t0_status=data.agent.t0Status;
                    if(t0_status == 'N'){
                        $("#t0StatusSel").attr("readonly","true");
                    }
                }
            });

            //商户费率验证  不能小于代理商的费率
            /* jQuery.validator.addMethod("rateLimit", function(value, element) {
             var isPass=false;
             //获取代理商签约费率
             $.ajax({
             type:"post",
             url:"/a/operate/agent/checkRate",
             dataType : "json",
             async: false,
             data: {agentNum:$("#agentNum").html()},
             success:function(data){
             if(data.success == 'true'){
             var rate=data.agentFee.rate*100;
             if(value >= rate){
             isPass=true;
             }
             }
             }
             });
             return this.optional(element) || isPass;
             }, "请检查所属代理商，输入费率不能低于代理商签约费率！"); */

            //$("#name").focus();
            $("#inputForm").validate({
                submitHandler: function(form){
                    if(!checkSign()) return;
                    $("#btnSubmit").attr("disabled","disabled");
                    loading('正在提交，请稍等...');
                    form.submit();
                },
                errorContainer: "#messageBox",
                errorPlacement: function(error, element) {
                    $("#messageBox").text("输入有误，请先更正。");
                    if (element.is(":checkbox")||element.is(":radio")||element.parent().is(".input-append")){
                        error.appendTo(element.parent().parent());
                    } else {
                        error.insertAfter(element);
                    }
                }
            });


            //企业对私账户 ，法人姓名必须和开户户名一致
            $("#btnSubmit").click(function(){
                var customerTypeSel =$("#customerTypeSel").val();//个体 or 企业
                var accountType=$("#accountTypeHidden").val();
                var accountName=$("#accountNameHidden").val();
                var legalName=$("#legalName").val();

                var channelStatus=$("#channelStatus-3").val();

                var businessAddress=$("#businessAddressSel").val();
                var province=$("#provinceSel").val();
                var city=$("#city1").val();
                var area=$("#district1").val();
                if(channelStatus == 'Y'){
                    if(businessAddress==null || businessAddress==''){
                        window.top.openDialog('提示：开通支付宝经营地址不能为空');
                        return false;
                    }
                    if(province==null || province==''){
                        window.top.openDialog('提示：开通支付宝经营省份不能为空');
                        return false;
                    }
                    if(city==null || city==''){
                        window.top.openDialog('提示：开通支付宝经营市不能为空');
                        return false;
                    }
                    if(area == null || area==''){
                        window.top.openDialog('提示：开通支付宝经营区县不能为空');
                        return false;
                    }
                }

                if(customerTypeSel == 'ENTERPRISE' && accountType== 'PERSONAL'){
                    if(accountName != legalName){
                        window.top.openDialog('提示：企业个人账户 ，法人姓名必须和开户户名一致！');
                        return false;
                    }
                }
                $("#btnSubmit").submit();
            });

            // 如果 是企业商户  需要隐藏部分表单
            var $customerTypeSel=$("#customerTypeSel").val();
            if($customerTypeSel && $customerTypeSel == 'PERSONAL'){
                $("#enterpriseTable").hide();//隐藏企业部分信息
                $("#enterpriseImage").hide();// 隐藏营业执照 和门头照
            }
            var $t0StatusSel=$("#t0StatusSel").val();
            if($t0StatusSel == 'N'){
                $("#settleModeSel").hide();
            }else{
                var isCapped = $('#isCappedHidden').val();
                if(isCapped == 'N'){
                    $("#capValue").hide();
                }
            }

            //点击经营行业
            /*  $('#businessSel').change(function(){
             var _this=$(this);
             // 清空和显示错误信息
             if(_this.val()){
             $("label[for='businessSel']").css('display','none');
             }else{
             $("label[for='businessSel']").css('display','block');
             }
             }); */

            // 如果企业商户  需额外录入几个字段
            $("#customerTypeSel").change(function(){
                //企业 需要额外录入两张图片
                if(this.value=='ENTERPRISE'){
                    $("#enterpriseTable").show();
                    $("#enterpriseImage").show();
                }else{
                    $("#enterpriseTable").hide();
                    $("#enterpriseImage").hide();
                }
                $("#s2id_businessSel .select2-chosen").html("--请选择经营行业--");

                /*初始化经营行业*/
                /*  $.ajax({
                 type:"get",
                 url:"/a/operate/business/brcbBusinessType/getByType",
                 dataType : "json",
                 data: {customerType:this.value},
                 success:function(data){

                 $('#businessSel').empty();
                 var $option = "<option code=''  value='' >--请选择经营行业--</option>";
                 $('#businessSel').append($option);

                 $.each(data.business, function(i, item) {
                 var $option = '<option type='+item.customerType+' value='+item.businessId+'>'+item.businessName+'</option>';
                 $('#businessSel').append($option);
                 });
                 }
                 }); */
            });

            // 如果T+0商户  需额外录入几个字段
            $("#t0StatusSel").change(function(){
                if(this.value=='Y'){
                    $("#settleModeSel").show();
                    var isCapped = $('#isCappedHidden').val();
                    if(isCapped == 'N'){
                        $("#capValue").hide();
                    }
                }else{
                    $("#settleModeSel").hide();
                }
            });

            //是否有封顶  选择事件  有封地 则显示  输入封顶值的输入框
            $('input:radio').click(function () {
                var checkValue=this.value;
                if(checkValue=='N'){
                    $("#capValue").hide();
                }else{
                    $("#capValue").show();
                }
            });

            // 手机号码验证
            jQuery.validator.addMethod("isMobile", function(value, element) {
                var length = value.length;
                var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;
                return this.optional(element) || (length == 11 && mobile.test(value));
            }, "请正确填写您的手机号码");

            // 银行卡号验证
            jQuery.validator.addMethod("isBankCard", function(value, element) {
                /*   var reg = /^(\d{16}|\d{19})$/; */
                var reg = /^\d{9,30}$/;
                return this.optional(element) || (reg.test(value));
            }, "请正确填写您的银行卡号");

            // 金额验证  两位小数
            jQuery.validator.addMethod("money", function(value, element) {
                var moneryReg = /^(([1-9]\d*)|\d)(\.\d{1,2})?$/;
                return this.optional(element) || (moneryReg.test(value));
            }, "请输入正确的金额");

            // 固话 正则
            jQuery.validator.addMethod("telephone", function(value, element) {
                var telephone = /^([0-9-]+)$/;
                return this.optional(element) || (telephone.test(value));
            }, "请输入正确的客服电话");

            // 身份证
            jQuery.validator.addMethod("isIdCardNo", function (value, element) {
                var isIdCard=IdentityCodeValid(value);
                return this.optional(element) || isIdCard;
            }, "请正确输入您的身份证号码（如最后一位为X需大写）");

            // 7位数字
            jQuery.validator.addMethod("sevenBit", function(value, element) {
                return this.optional(element) || value.length<8;
            }, "请输入正确的数值，最大长度7位");

            /*初始化经营行业*/
           /* $.ajax({
                type:"get",
                url:"/a/operate/business/brcbBusinessType/getByType",
                dataType : "json",
                data: {customerType:$("#customerTypeSel").val()},
                success:function(data){
                    var $businessTypeHidden=$("#businessTypeHidden").val();
                    $.each(data.business, function(i, item) {
                        var $option ='';
                        if($businessTypeHidden == item.businessName){
                            $option='<option selected=selected type='+item.customerType+' value='+item.businessId+'>'+item.businessName+'</option>';
                            $("#s2id_businessSel .select2-chosen").html(item.businessName);
                        }else{
                            $option='<option type='+item.customerType+' value='+item.businessId+'>'+item.businessName+'</option>';
                        }
                        $('#businessSel').append($option);
                    });
                }
            });


            /!*初始化银行大行列表*!/
            $.ajax({
                type:"get",
                url:"/a/operate/branch/brcbBankNo/getAllBank",
                dataType : "json",
                success:function(data){
                    $.each(data.allBank, function(i, item) {

                        var  $option ='';

                        if(item.bankName == $("#bankNameHidden").val()){
                            $option='<option selected=selected value='+item.bankName+'>'+item.bankName+'</option>';
                            $("#s2id_bankNameSel .select2-chosen").html(item.bankName);
                        }else{
                            $option='<option  value='+item.bankName+'>'+item.bankName+'</option>';
                        }

                        $('#bankNameSel').append($option);
                    });
                }
            });

            //初始化支行
            $.ajax({
                type:"post",
                url:'/a/operate/branch/brcbBankNo/getByArea?',
                dataType : "json",
                data: {province:$("#provinceHidden").val(),city:$("#cityHidden").val(),bankName:$("#bankNameHidden").val()},
                success:function(data){
                    $.each(data.branch,function(i,item){
                        var $branchOption ='';
                        if(item.bankSubName == $("#bankAddressHidden").val()){
                            $branchOption='<option selected=selected bankNo='+item.bankNo+' value='+item.bankSubName+'>'+item.bankSubName+'</option>';
                            $("#s2id_cardBranchSel .select2-chosen").html(item.bankSubName);
                        }else{
                            $branchOption='<option bankNo='+item.bankNo+' value='+item.bankSubName+'>'+item.bankSubName+'</option>';
                        }
                        $("#cardBranchSel").append($branchOption);
                    });
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });

            /!*初始化省份*!/
           $.ajax({
                type:"get",
                url:"/a/operate/province/brcbProvince/getProvince?",
                dataType : "json",
                success:function(data){
                    $.each(data.province, function(i, item) {

                        //银行卡信息中的省
                        var $option ='';
                        var provinceCode='';
                        if(item.province == $("#provinceHidden").val()){
                            $option='<option selected=selected code='+item.provinceid+' value='+item.province+'>'+item.province+'</option>';
                            $("#s2id_cardProvinceSel .select2-chosen").html(item.province);
                            provinceCode=item.provinceid;

                            var cityUrl ='/a/operate/city/brcbCity/getCityByProvince?provinceid='+provinceCode;

                            //根据provinceid 查询city
                            $.ajax({
                                url:cityUrl,
                                success:function(data){
                                    $.each(data.city,function(i,item){
                                        //银行卡信息中的市
                                        var $cityOption ='';
                                        if(item.city == $("#cityHidden").val()){
                                            $cityId=item.cityid;
                                            $cityOption='<option selected=selected code='+item.cityid+' value='+item.city+' >'+item.city+'</option>';
                                            $("#s2id_cardCitySel .select2-chosen").html(item.city);
                                        }else{
                                            $cityOption='<option code='+item.cityid+' value='+item.city+' >'+item.city+'</option>';
                                        }
                                        $("#cardCitySel").append($cityOption);
                                    });
                                },
                                error:function(){
                                    console.log("fail");
                                    return;
                                }
                            });

                        }else{
                            $option='<option code='+item.provinceid+' value='+item.province+'>'+item.province+'</option>';
                        }

                        //开卡省份
                        $('#cardProvinceSel').append($option);


                        //基本信息中的省
                        var $businessOption ='';
                        if(item.provinceid == $("#provinceNameHidden").val()){

                            $businessOption='<option selected=selected code='+item.provinceid+' value='+item.provinceid+'>'+item.province+'</option>';
                            $("#s2id_provinceSel .select2-chosen").html(item.province);
                            provinceCode=item.provinceid;

                            var cityUrl ='/a/operate/city/brcbCity/getCityByProvince?provinceid='+provinceCode;

                            //根据provinceid 查询city
                            $.ajax({
                                url:cityUrl,
                                success:function(data){
                                    $.each(data.city,function(i,item){
                                        //基本信息中的市
                                        var $businessCityOption ='';
                                        if(item.cityid == $("#cityNameHidden").val()){
                                            $businessCityOption='<option selected=selected code='+item.cityid+' value='+item.cityid+' >'+item.city+'</option>';
                                            $("#s2id_citySel .select2-chosen").html(item.city);

                                            //初始化区
                                            var areaUrl = '/a/operate/area/brcbAreas/getAreaByCity?cityid='+item.cityid;
                                            $.ajax({
                                                url:areaUrl,
                                                success:function(data){
                                                    $.each(data.area,function(i,item){
                                                        var $areaOption ='';
                                                        if(item.areaid == $("#districtNameHidden").val()){
                                                            $areaOption='<option selected=selected code='+item.areaid+' value='+item.areaid+'>'+item.area+'</option>';
                                                            $("#s2id_areaSel .select2-chosen").html(item.area);
                                                        }else{
                                                            $areaOption='<option code='+item.areaid+' value='+item.areaid+'>'+item.area+'</option>';
                                                        }
                                                        $("#areaSel").append($areaOption);
                                                    });
                                                },
                                                error:function(){
                                                    console.log("fail");
                                                    return;
                                                }
                                            });

                                        }else{
                                            $businessCityOption='<option code='+item.cityid+' value='+item.city+' >'+item.city+'</option>';
                                        }

                                        $("#citySel").append($businessCityOption);
                                    });
                                },
                                error:function(){
                                    console.log("fail");
                                    return;
                                }
                            });

                        }else{
                            $businessOption='<option code='+item.provinceid+' value='+item.provinceid+'>'+item.province+'</option>';
                        }
                        //经营地区
                        $('#provinceSel').append($businessOption);
                   });
                }
            });





           /* //点击选择省份
            $('#provinceSel').change(function(){


                //清空 市区 option 内容
                $("#s2id_citySel .select2-chosen").html('--请选择市--');
                $("#s2id_areaSel .select2-chosen").html('--请选择区--');

                $("#citySel,#areaSel").empty();

                var $cityOption = "<option code=''  value='' >--请选择市--</option>";
                var $areaOption = "<option code=''  value='' >--请选择区--</option>";

                $("#citySel").append($cityOption);
                $("#areaSel").append($areaOption);

                var _this=$(this);
                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='provinceSel']").css('display','none');
                }else{
                    $("label[for='provinceSel']").css('display','block');
                }

                //遍历添加区
                var _this=$(this);
                var provinceCode = _this.find('option:selected').attr('code');
                var cityUrl ='/a/operate/city/brcbCity/getCityByProvince?provinceid='+provinceCode;
                masterAddrC(cityUrl,'#citySel');

                setTimeout(function(){
                    var cityCode = $('#citySel').find('option').eq(0).attr('code');
                    var areaUrl = '/a/operate/area/brcbAreas/getAreaByCity?cityid='+cityCode;
                    masterAddrA(areaUrl,'areaSel');
                    setTimeout(function(){
                        $('#provinceSel').attr('province_id',provinceCode);
                        $('#citySel').attr('city_id',$('#citySel').find('option').eq(0).attr('code'));
                        $('#areaSel').attr('area_id',$('#areaSel').find('option').eq(0).attr('code'));
                    },300);
                },300);
            });

            //点击选择城市
           $('#citySel').change(function(){

                //清空 市区 option 内容
                $("#s2id_areaSel .select2-chosen").html('--请选择区--');

                $("#areaSel").empty();

                var $option = "<option code=''  value='' >--请选择区--</option>";
                $("#areaSel").append($option);


                var _this=$(this);
                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='citySel']").css('display','none');
                }else{
                    $("label[for='citySel']").css('display','block');
                }

                var cityCode = _this.find('option:selected').attr('code');
                var areaUrl = '/a/operate/area/brcbAreas/getAreaByCity?cityid='+cityCode;
                masterAddrA(areaUrl,'#areaSel');
                setTimeout(function(){
                    $('#citySel').attr('city_id',cityCode);
                    $('#areaSel').attr('area_id',$('#areaSel').find('option').eq(0).attr('code'));
                },100);
            });*/

            //点击 选择开卡省份
        $('#cardProvinceSel').change(function(){

                //清空市区  连行号
                $("#s2id_cardCitySel .select2-chosen").html('--请选择市--');
                $("#s2id_cardBranchSel .select2-chosen").html('--请选择支行--');

                $("#cardCitySel,#cardBranchSel").empty();

                var $cityOption = "<option code=''  value='' >--请选择市--</option>";
                var $branchOption = "<option code=''  value='' >--请选择支行--</option>";

                $("#cardCitySel").append($cityOption);
                $("#cardBranchSel").append($branchOption);

                //清空联行号
                $("#bankNo").val('');
                $("#bankNo").attr('readonly','readonly');


                var _this=$(this);
                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='cardProvinceSel']").css('display','none');
                }else{
                    $("label[for='cardProvinceSel']").css('display','block');
                }

                var provinceCode = _this.find('option:selected').attr('code');
                var cityUrl ='/a/operate/city/brcbCity/getCityByProvince?provinceid='+provinceCode;
                masterAddrCCard(cityUrl,'#cardCitySel');
                setTimeout(function(){
                    var cityCode = $('#cardCitySel').find('option').eq(0).attr('code');
                    var areaUrl = '/a/operate/area/brcbAreas/getAreaByCity?cityid='+cityCode;
                    masterAddrACard(areaUrl,'areaSel');
                    setTimeout(function(){
                        $('#cardProvinceSel').attr('province_id',provinceCode);
                        $('#cardCitySel').attr('city_id',$('#cardCitySel').find('option').eq(0).attr('code'));
                        $('#cardBranchSel').attr('branch_id',$('#cardBranchSel').find('option').eq(0).attr('code'));
                    },300);
                },300);
            });


            //点击选择开卡城市
            $('#cardCitySel').change(function(){

                //清空支行  、联行号
                $("#s2id_cardBranchSel .select2-chosen").html('--请选择支行--');

                $("#cardBranchSel").empty();

                var $branchOption = "<option code=''  value='' >--请选择支行--</option>";
                $("#cardBranchSel").append($branchOption);

                $("#bankNo").val('');
                $("#bankNo").attr('readonly','readonly');

                var _this=$(this);
                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='cardCitySel']").css('display','none');
                }else{
                    $("label[for='cardCitySel']").css('display','block');
                }

                var cityCode = _this.find('option:selected').attr('code');
                var areaUrl = '/a/operate/branch/brcbBankNo/getByArea?';
                masterAddrCard(areaUrl,'#cardBranchSel');
                setTimeout(function(){
                    $('#cardCitySel').attr('city_id',cityCode);
                    $('#cardBranchSel').attr('area_id',$('#areaSel').find('option').eq(0).attr('code'));
                },100);
            });


            // 选择开户行事件
            $("#bankNameSel").change(function(){
                var _this=$(this);
                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='bankNameSel']").css('display','none');
                }else{
                    $("label[for='bankNameSel']").css('display','block');
                }
                //清空市区  连行号
                $("#s2id_cardProvinceSel .select2-chosen").html('--请选择省--');
                $("#s2id_cardCitySel .select2-chosen").html('--请选择市--');
                $("#s2id_cardBranchSel .select2-chosen").html('--请选择支行--');
                $("#cardProvinceSel,#cardBranchSel,#cardCitySel").find("option:selected").removeAttr("selected");
                //清空联行号
                $("#bankNo").val('');
                $("#bankNo").attr('readonly','readonly');
            });

            //点击选择支行
          /*  $('#cardBranchSel').change(function(){
                var _this=$(this);
                var bankNo = _this.find('option:selected').attr('bankNo');

                if(bankNo == 'other'){
                    $("#bankNo").val('');
                    $("#bankNo").removeAttr('readonly');
                }else{
                    $("#bankNo").val(bankNo);
                    $("#bankNo").attr('readonly','readonly');
                }

                // 清空和显示错误信息
                if(_this.val()){
                    $("label[for='cardBranchSel']").css('display','none');
                    $("label[for='bankNo']").css('display','none');
                }else{
                    $("label[for='cardBranchSel']").css('display','block');
                    $("label[for='bankNo']").css('display','block');
                }
            });*/
        });


        // 遍历添加city
        function masterAddrC(url,appendId){
            $.ajax({
                url:url,
                success:function(data){
                    $.each(data.city,function(i,item){
                        var $option = '<option code='+item.cityid+' value='+item.cityid+' >'+item.city+'</option>';
                        $(appendId).append($option);
                    });
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });
        }
        function masterAddrCCard(url,appendId){
            $.ajax({
                url:url,
                success:function(data){
                    $.each(data.city,function(i,item){
                        var $option = '<option code='+item.cityid+' value='+item.city+' >'+item.city+'</option>';
                        $(appendId).append($option);
                    });
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });
        }

        // 遍历添加区
        function masterAddrA(url,select){
            $(select).empty();
            $.ajax({
                url:url,
                success:function(data){
                    $(select).empty();
                    $.each(data.area,function(i,item){
                        var $option = '<option code='+item.areaid+' value='+item.areaid+'>'+item.area+'</option>';
                        $(select).append($option);
                    });
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });
        }
        // 遍历添加区
        function masterAddrACard(url,select){
            $(select).empty();
            $.ajax({
                url:url,
                success:function(data){
                    $(select).empty();
                    $.each(data.area,function(i,item){
                        var $option = '<option code='+item.areaid+' value='+item.area+'>'+item.area+'</option>';
                        $(select).append($option);
                    });
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });
        }

        //遍历添加支行
        function masterAddrCard(url,select){

            var $bankName=$("#bankNameSel").val();
            var $provinceName=$("#cardProvinceSel").val();

            if(!$bankName || !$provinceName){
                window.top.openDialog('提示：请先选择开户行和开卡省份！');
                return;
            }

            $.ajax({
                type:"post",
                url:url,
                dataType : "json",
                data: {province:$("#cardProvinceSel").val(),city:$("#cardCitySel").val(),bankName:$("#bankNameSel").val()},
                success:function(data){
                    $.each(data.branch,function(i,item){
                        var $option = '<option bankNo='+item.bankNo+' value='+item.bankSubName+'>'+item.bankSubName+'</option>';
                        $(select).append($option);
                    });
                    var $option = "<option bankNo='other' value='other'>其他支行</option>";
                    $(select).append($option);
                },
                error:function(){
                    console.log("fail");
                    return;
                }
            });
        }

        //身份证验证
        function IdentityCodeValid(code) {
            var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
            var tip = "";
            var pass= true;

            if(!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|10|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
                tip = "身份证号格式错误";
                pass = false;
            }

            else if(!city[code.substr(0,2)]){
                tip = "地址编码错误";
                pass = false;
            }
            else{
                //18位身份证需要验证最后一位校验位
                if(code.length == 18){
                    code = code.split('');
                    //∑(ai×Wi)(mod 11)
                    //加权因子
                    var factor = [ 7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2 ];
                    //校验位
                    var parity = [ 1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2 ];
                    var sum = 0;
                    var ai = 0;
                    var wi = 0;
                    for (var i = 0; i < 17; i++)
                    {
                        ai = code[i];
                        wi = factor[i];
                        sum += ai * wi;
                    }
                    var last = parity[sum % 11];
                    if(parity[sum % 11] != code[17]){
                        tip = "校验位错误";
                        pass =false;
                    }
                }
            }
            return pass;
        }
        //如果 设置封顶 需要输入封顶值
        /* 	function radioCheck(own){
         alert(own.value);
         var capValue = document.getElementById("capValue");
         } */
    </script>
    <style type="text/css">
        ol {list-style:none; }
    </style>

</head>
<body>

<ul class="nav nav-tabs">
    <li class="active"><a href="/a/operate/customer/brcbCustomer/editForm?id=534709">商户信息修改</a></li>
</ul><br/>
<form id="inputForm" onsubmit="toSubmit()" class="form-horizontal" action="updateTbBusinessUser" method="post" enctype="multipart/form-data">

    <input id="id" name="businessUid" th:value="${businessUser.businessUid}" type="hidden" value="10"/>
    <script type="text/javascript">top.$.jBox.closeTip();</script>

    <h6>商户基本信息</h6>
    <hr width="100%" style="border:1px solid #008fe2;"/>
    <table>
        <tr>
            <td>
                <div class="control-group">
                    <label class="control-label">所属代理商：</label>
                    <div class="controls">
                        <span id="agentNum" style="display:none;">A149549246147410970</span>
                        <span id="agentName"></span>
                    </div>
                </div>
            </td>

        </tr>
        <tr>
            <td><div class="control-group">
                <label class="control-label">商户类型：</label>
                <div class="controls">
                    <select id="customerTypeSel" name="businessUserType" class="input-xlarge required">
                        <option value="ENTERPRISE" th:selected="${businessUser.businessUserType=='ENTERPRISE'}">企业商户</option>
                        <option value="PERSONAL" th:selected="${businessUser.businessUserType=='PERSONAL'}">个体户</option>
                    </select>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
            <td><div class="control-group">
                <label class="control-label">经营名称：</label>
                <div class="controls">
                    <input id="businessName" name="manageName" th:value="${businessUser.manageName}" class="input-xlarge required" type="text" value="张明盟小卖部" maxlength="255"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
        </tr>
        <tr>

            <td><div class="control-group">
                <label class="control-label">商户名称：</label>
                <div class="controls">
                    <input id="customerName" name="businessUsername" th:value="${businessUser.businessUsername}" class="input-xlarge required" type="text" value="张明盟小卖部" maxlength="50"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
            <td><div class="control-group">
                <label class="control-label">法人姓名：</label>
                <div class="controls">
                    <input id="legalName" name="legalPeopleName" th:value="${businessUser.legalPeopleName}" class="input-xlarge required" type="text" value="张明盟" maxlength="32"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
        </tr>
        <tr>
            <td>
                <div class="control-group">
                    <label class="control-label">法人身份证：</label>
                    <div class="controls">
                        <input id="legalId" name="legalPeopleIdentityCard" th:value="${businessUser.legalPeopleIdentityCard}" class="input-xlarge required isIdCardNo" type="text" value="130826199106117918" maxlength="32"/>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
            <td><div class="control-group">
                <label class="control-label">联系人：</label>
                <div class="controls">
                    <input id="contact" name="contactPeople" th:value="${businessUser.contactPeople}" class="input-xlarge required" type="text" value="张明盟" maxlength="50"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
        </tr>
        <tr>
            <td><div class="control-group">
                <label class="control-label">联系电话：</label>
                <div class="controls">
                    <input id="contactPhone" name="contactPhone" th:value="${businessUser.contactPhone}" class="input-xlarge required isMobile" type="text" value="15720308087" maxlength="50"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
            <td>
                <div class="control-group">
                    <label class="control-label">联系邮箱：</label>
                    <div class="controls">
                        <input id="contactEmail" name="contactMail" th:value="${businessUser.contactMail}" class="input-xlarge email" type="text" value="" maxlength="50"/>
                        <!-- <span class="help-inline"><font color="red">*</font> </span> -->
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td><div class="control-group">
                <label class="control-label">客服电话：</label>
                <div class="controls">
                    <input id="servicePhone" name="servicePhone" th:value="${businessUser.servicePhone}" class="input-xlarge telephone required " type="text" value="18410178782" maxlength="20"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>


            </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">经营地址：</label>
                    <div class="controls">
                        <input id="businessAddressSel" name="manageAddress" th:value="${businessUser.manageAddress}" class="input-xlarge" type="text" value="" maxlength="50"/>
                    </div>
                </div>
            </td>
        </tr>
        <tr>

            <td>

                <div class="control-group">
                <label class="control-label">经营省名称：</label>
                <div class="controls">
                    <select id="provinceSel"  name="manageProvince" class="input-xlarge required">
                        <option  value=""  selected="selected">&#45;&#45;请选择省份&#45;&#45;</option>
                        <option th:selected="${province.areaCode==businessUser.manageProvince}"  th:each="province:${provinceList}" th:text="${province.upAreaName}" th:value="${province.areaCode}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>
                    </select>
                </div>
            </div>
                <div class="control-group">
                    <label class="control-label" ></label>
                    <div class="controls">
                      <dl></dl>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label" >经营市名称：</label>
                    <div class="controls">
                        <select id="city1" name="manageCity" class="input-xlarge required">
                            <option value="" selected="selected">&#45;&#45;请选择市&#45;&#45;</option>
                            <option th:selected="${city.areaCode==businessUser.manageCity}"  th:each="city:${cityList}" th:text="${city.upAreaName}" th:value="${city.areaCode}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>
                        </select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" >经营区名称：</label>
                    <div class="controls">
                        <select id="district1" name="manageDistrict" class="input-xlarge required">
                            <option value="" selected="selected">&#45;&#45;请选择区&#45;&#45;</option>
                            <option th:selected="${district.areaCode==businessUser.manageDistrict}"  th:each="district:${districtList}" th:text="${district.upAreaName}" th:value="${district.areaCode}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>
                        </select>
                    </div>


                </div>
            </td>
        </tr>
    </table>


   <table id="enterpriseTable">

        <tr>

            <td><div class="control-group">
                <label class="control-label">注册地址：</label>
                <div class="controls">
                    <input id="address" name="registerAddress" th:value="${businessUser.registerAddress}" class="input-xlarge required" type="text" value="" maxlength="50"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>

            <td><div class="control-group">
                <label class="control-label">营业执照编号：</label>
                <div class="controls">
                    <input id="licenseNo" name="businessLicenseNo" th:value="${businessUser.businessLicenseNo}" class="input-xlarge required" type="text" value="" maxlength="50"/>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
        </tr>
    </table>

    <h6>业务信息</h6>
    <hr width="100%" style="border:1px solid #008fe2;"/>
    <div class="control-group">
        <input type="hidden" name="tbBusiness.businessUid" th:value="${businessUser.businessUid}">
        <label class="control-label">通道费率设置：</label>
        <div id="tabs">
            <ul>

                <li><a href="#tabs-1">微信线下支付</a></li>

              <!--  <li><a href="#tabs-2">微信APP支付</a></li>-->

                <li><a href="#tabs-3">支付宝</a></li>

            </ul>

            <div id="tabs-1" >
               <!-- <input type="hidden" name="brcbChannelFeeList[0].channelNum" value="WECHAT" id="channelNum-1">
                <input type="hidden" name="brcbChannelFeeList[0].channelName" value="微信线下支付" >
                <input type="hidden" name="brcbChannelFeeList[0].customerFee.transFee.id" value="">
                <input type="hidden" name="brcbChannelFeeList[0].customerFee.settleFee.id" value="">
                <input type="hidden" name="brcbChannelFeeList[0].customerFee.transFee.customerFeeNum" value="">
                <input type="hidden" name="brcbChannelFeeList[0].customerFee.settleFee.customerFeeNum" value="">-->

                <div class="control-group">
                    <label class="control-label">是否开通：</label>
                    <div class="controls">
                        <select  id="channelStatus-1" name="tbBusiness.wechatPay" data-index="1" class="input-xlarge channelStatus">
                            <option th:selected="${businessUser.tbBusiness.wechatPay=='Y'}" value="Y" >开通</option>
                            <option th:selected="${businessUser.tbBusiness.wechatPay=='N'}" value="N" selected="selected">不开通</option>
                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
                <div id="channelSetting-1">
                    <table>
                        <tr>
                            <td><div class="control-group">
                                <label class="control-label">收款费率%：</label>
                                <div class="controls">
                                    <input name="tbBusiness.wechatRate" th:value="${businessUser.tbBusiness.wechatRate}" data-index = "1" value="" type="text" htmlEscape="false" maxlength="7"  class="input-xlarge required number checkSign tradeFee" id="tradeFee-1">

                                    <span id="tradeFee_label_1" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div></td>
                            <td>
                                <!--<div class="control-group">
                                    <label class="control-label" >T+0状态：</label>
                                    <div class="controls">
                                        <select disabled="disabled" id="t0StatusSel-1" name="" data-index="1" class="input-xlarge t0StatusSel">
                                            <option value="N" selected="selected">不开通</option>
                                            <option value="Y">开通</option>
                                        </select>
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>-->
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">经营行业：</label>
                                    <div class="controls">
                                        <select id="channelBusinessType-1" name="tbBusiness.wechatIndustry" data-index="1" class="input-xlarge required">
                                            <option value="" selected="selected">--请选择经营行业--</option>
                                            <option th:each="wechat:${wechatTradeList}" th:selected="${wechat.tradeName==businessUser.tbBusiness.wechatIndustry}" th:text="${wechat.tradeName}" th:value="${wechat.tradeName}"></option>
                                        </select>
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>
                                <input type="hidden" data-index = "1" id="businessTypeHidden-1" value=""  >
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">联系人微信账号类型：</label>
                                    <div class="controls">
                                        <select id="brcbChannelFeeList0.contactType" name="tbBusiness.wechatType" data-index="1" class="input-xlarge">
                                            <option value="" selected="selected">--请选择账号类型--</option>
                                            <option value="type_wechatid" th:selected="${businessUser.tbBusiness.wechatType=='type_wechatid'}">收款人微信号</option>
                                            <option value="type_openid" th:selected="${businessUser.tbBusiness.wechatType=='type_openid'}">收款人openId</option>
                                        </select>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">联系人微信账号：</label>
                                    <div class="controls">
                                        <input id="brcbChannelFeeList0.contactId" th:value="${businessUser.tbBusiness.wechatNum}" name="tbBusiness.wechatNum" data-index="1" class="input-xlarge" type="text" value=""/>
                                    </div>
                                </div>
                            </td>
                        </tr>

                    </table>
                    <!--<table id="settleModeSel-1" class="settleModeSel">
                        <tr>
                            <td><div class="control-group">
                                <label class="control-label">T+0费率%:</label>
                                <div class="controls">
                                    <input type="text" class="input-xlarge required number settleFee" id="settleFee-1" data-index = "1"   placeholder="请输入T+0费率 " maxLength="5"  name="brcbChannelFeeList[0].customerFee.settleFee.rate" value=""  />
                                    <span id="settleFee_label_1" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div>
                            </td>
                            <td><div class="control-group">
                                <label class="control-label">加收单笔（元）:</label>
                                <div class="controls">
                                    <input type="text" class="input-xlarge required number money fixedFee" id="fixedFee-1" data-index = "1"   placeholder="请输入单笔费用 " maxLength=7  name="brcbChannelFeeList[0].customerFee.settleFee.fixedFee" value=""  />
                                    <span id="settleFee_label_1" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">是否封顶:</label>
                                    <div class="controls">
                                       &lt;!&ndash; <input id="brcbChannelFeeList0.customerFee.settleFee.isCapped1" name="brcbChannelFeeList[0].customerFee.settleFee.isCapped" name="isCapped" checked="true" type="radio" value="Y"/><label for="brcbChannelFeeList0.customerFee.settleFee.isCapped1">是</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input id="brcbChannelFeeList0.customerFee.settleFee.isCapped2" name="brcbChannelFeeList[0].customerFee.settleFee.isCapped" name="isCapped" type="radio" value="N"/><label for="brcbChannelFeeList0.customerFee.settleFee.isCapped2">否</label>
                                        <span class="help-inline"><font color="red">*</font> </span>&ndash;&gt;
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="control-group">
                                    &lt;!&ndash; <label class="control-label">结算方式:</label> &ndash;&gt;
                                    <div class="controls">

                                        <input type="hidden" name="brcbChannelFeeList[0].customerFee.settleFee.settleMode" value="T0_HANDING">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td id="capValue">
                                <div class="control-group">
                                    <label class="control-label">封顶值（元）:</label>
                                    <div class="controls">
                                        <input type="text" class="input-xlarge required  number money"  placeholder="请输入封顶值 " maxLength=7  name="brcbChannelFeeList[0].customerFee.settleFee.upperFee" value=""  />
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>-->
                </div>
            </div>


            <div id="tabs-3" >
<!--                <input type="hidden" name="brcbChannelFeeList[2].channelNum" value="ALIPAY" id="channelNum-3">
                <input type="hidden" name="brcbChannelFeeList[2].channelName" value="支付宝" >
                <input type="hidden" name="brcbChannelFeeList[2].customerFee.transFee.id" value="1038537">
                <input type="hidden" name="brcbChannelFeeList[2].customerFee.settleFee.id" value="">
                <input type="hidden" name="brcbChannelFeeList[2].customerFee.transFee.customerFeeNum" value="f0632dd62d954dca892183ffef45cab8">
                <input type="hidden" name="brcbChannelFeeList[2].customerFee.settleFee.customerFeeNum" value="">-->
                <div class="control-group">
                    <label class="control-label">是否开通：</label>
                    <div class="controls">
                        <select id="channelStatus-3" name="tbBusiness.alipay" data-index="3" class="input-xlarge channelStatus">
                            <option value="Y" th:selected="${businessUser.tbBusiness.alipay=='Y'}" >开通</option>
                            <option value="N" th:selected="${businessUser.tbBusiness.alipay=='N'}" selected="selected">不开通</option>
                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
                <div id="channelSetting-3">
                    <table>
                        <tr>
                            <td><div class="control-group">
                                <label class="control-label">收款费率%：</label>
                                <div class="controls">
                                    <input name="tbBusiness.aliRate" th:value="${businessUser.tbBusiness.aliRate}" data-index = "3" value="0.2500" type="text" htmlEscape="false" maxlength="7"  class="input-xlarge required number checkSign tradeFee" id="tradeFee-3">

                                    <span id="tradeFee_label_3" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div></td>
                            <td>
                              <!--  <div class="control-group">
                                    <label class="control-label">T+0状态：</label>
                                    <div class="controls">
                                        <select disabled="disabled" id="t0StatusSel-3" name="" data-index="3" class="input-xlarge t0StatusSel">
                                            <option value="N" selected="selected">不开通</option>
                                            <option value="Y">开通</option>
                                        </select>
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>-->
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">经营行业：</label>
                                    <div class="controls">
                                        <select id="channelBusinessType-3" name="tbBusiness.aliIndustry" data-index="3" class="input-xlarge required">
                                            <option value="">--请选择经营行业--</option>
                                            <option th:selected="${alipay.firstType==businessUser.tbBusiness.aliType}" th:each="alipay:${alipayList}" th:value="${alipay.firstType}" th:text="${alipay.firstType}"></option>

                                        </select>
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>
                                <input type="hidden" data-index = "3" id="businessTypeHidden-3" value="2015050700000000"  >
                            </td>
                        </tr>

                    </table>
                   <!-- <table id="settleModeSel-3" class="settleModeSel">
                        <tr>
                            <td><div class="control-group">
                                <label class="control-label">T+0费率%:</label>
                                <div class="controls">
                                    <input type="text" class="input-xlarge required number settleFee" id="settleFee-3" data-index = "3"   placeholder="请输入T+0费率 " maxLength="5"  name="brcbChannelFeeList[2].customerFee.settleFee.rate" value=""  />
                                    <span id="settleFee_label_3" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div>
                            </td>
                            <td><div class="control-group">
                                <label class="control-label">加收单笔（元）:</label>
                                <div class="controls">
                                    <input type="text" class="input-xlarge required number money fixedFee" id="fixedFee-3" data-index = "3"   placeholder="请输入单笔费用 " maxLength=7  name="brcbChannelFeeList[2].customerFee.settleFee.fixedFee" value=""  />
                                    <span id="settleFee_label_4" style="color:red;"></span>
                                    <span class="help-inline"><font color="red">*</font> </span>
                                </div>
                            </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="control-group">
                                    <label class="control-label">是否封顶:</label>
                                    <div class="controls">
                                        &lt;!&ndash;<input id="brcbChannelFeeList2.customerFee.settleFee.isCapped1" name="brcbChannelFeeList[2].customerFee.settleFee.isCapped" name="isCapped" checked="true" type="radio" value="Y"/><label for="brcbChannelFeeList2.customerFee.settleFee.isCapped1">是</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                        <input id="brcbChannelFeeList2.customerFee.settleFee.isCapped2" name="brcbChannelFeeList[2].customerFee.settleFee.isCapped" name="isCapped" type="radio" value="N"/><label for="brcbChannelFeeList2.customerFee.settleFee.isCapped2">否</label>
                                        <span class="help-inline"><font color="red">*</font> </span>&ndash;&gt;
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="control-group">
                                    &lt;!&ndash; <label class="control-label">结算方式:</label> &ndash;&gt;
                                    <div class="controls">

                                        <input type="hidden" name="brcbChannelFeeList[2].customerFee.settleFee.settleMode" value="T0_HANDING">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td id="capValue">
                                <div class="control-group">
                                    <label class="control-label">封顶值（元）:</label>
                                    <div class="controls">
                                        <input type="text" class="input-xlarge required  number money"  placeholder="请输入封顶值 " maxLength=7  name="brcbChannelFeeList[2].customerFee.settleFee.upperFee" value=""  />
                                        <span class="help-inline"><font color="red">*</font> </span>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>-->
                </div>
            </div>

        </div>
    </div>

    <h6>商户银行卡信息</h6>
    <hr width="100%" style="border:1px solid #008fe2;"/>
    <table id="bankCardInfo">
        <tr>
            <td>
                <div class="control-group">
                    <input type="hidden" name="tbBankcardInfo.businessUid" th:value="${businessUser.businessUid}">
                    <input type="hidden" id="bankCity" th:value="${businessUser.tbBankcardInfo.bankCity}">
                    <label class="control-label">账户类型 ：</label>
                    <div class="controls">
                        <select id="accountTypeHidden" name="tbBankcardInfo.bankcardType" class="input-xlarge ">
                            <option value="COMPANY" th:selected="${businessUser.tbBankcardInfo.bankcardType=='COMPANY'}">公司账户</option>
                            <option value="PERSONAL" th:selected="${businessUser.tbBankcardInfo.bankcardType=='PERSONAL'}" selected="selected">个人账户</option>
                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">开户户名：</label>
                    <div class="controls">
                        <input id="accountNameHidden" th:value="${businessUser.tbBankcardInfo.bankcardName}" name="tbBankcardInfo.bankcardName" class="input-xlarge required" type="text" value="张明盟" maxlength="100"/>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="control-group">
                    <label class="control-label">开户卡号：</label>
                    <div class="controls">
                        <input id="bankCardInfo.bankCard" th:value="${businessUser.tbBankcardInfo.bankcardNum}" name="tbBankcardInfo.bankcardNum" class="input-xlarge required isBankCard" type="text" value="622908321066573415" maxlength="32"/>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">开户行名称：</label>
                    <div class="controls">
                        <select id="bankNameSel" name="tbBankcardInfo.bankName" class="input-xlarge required">
                            <option value="">--请选择银行--</option>

                            <option th:selected="${businessUser.tbBankcardInfo.bankName==bank}" th:value="${bank}" th:text="${bank}" value="农业银行" th:each="bank:${bankNameList}">农业银行</option>
                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
        <tr >
            <td>
                <div class="control-group">
                    <label class="control-label">开卡省份：</label>
                    <div class="controls">
                        <select id="cardProvinceSel" name="tbBankcardInfo.bankProvince" class="input-xlarge required">
                            <option value="">--请选择省--</option>
                            <option th:selected="${province.upAreaName==businessUser.tbBankcardInfo.bankProvince}"  th:each="province:${provinceList}" th:text="${province.upAreaName}" th:value="${province.upAreaName}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>
                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>

            <td>
                <div class="control-group">
                    <label class="control-label">开卡城市：</label>
                    <div class="controls">

                        <select id="cardCitySel" name="tbBankcardInfo.bankCity" class="input-xlarge required">
                            <option value="">--请选择城市--</option>
                            <option th:selected="${city.upAreaName==businessUser.tbBankcardInfo.bankCity}"  th:each="city:${bankCityList}" th:text="${city.upAreaName}" th:value="${city.upAreaName}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>

                        </select>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td><div class="control-group">
                <label class="control-label">支行：</label>
                <div class="controls">

                    <select id="cardBranchSel"  name="tbBankcardInfo.bankDetailed" class="input-xlarge required">
                        <option value="">--请选择支行--</option>
                        <option th:selected="${bank.bankSubName==businessUser.tbBankcardInfo.bankDetailed}"  th:each="bank:${bankList}" th:text="${bank.bankSubName}" th:value="${bank.bankSubName}"  value=""  >&#45;&#45;请选择省份&#45;&#45;</option>


                    </select>
                    <span class="help-inline"><font color="red">*</font> </span>
                </div>
            </div></td>
            <td>
                <div class="control-group">
                    <label class="control-label">联行号：</label>
                    <div class="controls">
                        <input id="bankNo" th:value="${businessUser.tbBankcardInfo.bandContact}"  name="tbBankcardInfo.bandContact" placeholder="选择开户支行自动赋值" class="input-xlarge required number" readonly="readonly" type="text" value="309100003181" maxlength="32"/>
                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
    </table>
    <h6>商户资料信息</h6>
    <hr width="100%" style="border:1px solid #008fe2;">
    <table>
        <tr>
            <td>
                <div class="control-group">
                    <label class="control-label">身份证正面：</label>
                    <div class="controls">
                        <input id="rightID"  style="width:139px;" placeholder="请选择身份证正面照片" axlength="255" class="input-xlarge required" readonly="readonly" type="text" th:value="${businessUser.identityCardFront}" value=""/>
                        <input type="file" id="file1" name="identityCardFrontImg"  style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="rightIDPreview">
                            <li >
                                <img  class="imgList" src="" url="" th:attr="src=${businessUser.identityCardFront}" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                            </li>
                        </ol>
                        <a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;
                        <a href="javascript:" onclick="clearImg(this);" class="btn">清除</a>

                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">身份证反面：</label>
                    <div class="controls">
                        <input id="reservedID"  style="width:139px;" th:value="${businessUser.identityCardReverse}" placeholder="请选择身份证反面照片" axlength="255" class="input-xlarge required" readonly="readonly" type="text" value="/userfiles/ed62b086d4734fff9e09ef76831b3b83/images/customer/2017/05/%E6%99%AE%E4%BB%98%E5%AE%9D-%E5%BC%A0%E6%98%8E%E7%9B%9F-JAVA%E5%B7%A5%E7%A8%8B%E5%B8%88.png"/>
                        <input type="file" id="file2" name="identityCardReverseImg"  style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="reservedIDPreview"> <li >
                            <img  class="imgList" src="" url="" th:attr="src=${businessUser.identityCardReverse}" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this);" class="btn">清除</a>

                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="control-group">
                    <label class="control-label">手持身份证：</label>
                    <div class="controls">
                        <input id="IDWithHand"  style="width:139px;" th:value="${businessUser.identityCardHand}" placeholder="请选择手持身份证照片" axlength="255" class="input-xlarge" readonly="readonly" type="text" value="/userfiles/ed62b086d4734fff9e09ef76831b3b83/images/customer/2017/05/%E6%99%AE%E4%BB%98%E5%AE%9D-%E5%BC%A0%E6%98%8E%E7%9B%9F-JAVA%E5%B7%A5%E7%A8%8B%E5%B8%88.png"/>
                        <input type="file" id="file3" name="identityCardHandImg"  style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="IDWithHandPreview"> <li >
                            <img  class="imgList" src="" url="" th:attr="src=${businessUser.identityCardHand}" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this);" class="btn">清除</a>

                        <!-- <span class="help-inline"><font color="red">*</font> </span> -->
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">银行卡正面：</label>
                    <div class="controls">
                        <input id="rightBankCard" style="width:139px;" th:value="${businessUser.bankCardFront}" placeholder="请选择银行卡正面照片" axlength="255" class="input-xlarge required" readonly="readonly" type="text" value="/userfiles/ed62b086d4734fff9e09ef76831b3b83/images/customer/2017/05/%E6%99%AE%E4%BB%98%E5%AE%9D-%E5%BC%A0%E6%98%8E%E7%9B%9F-JAVA%E5%B7%A5%E7%A8%8B%E5%B8%88.png"/>
                        <input type="file" id="file4"  name="bankCardFrontImg"  style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="rightBankCardPreview"> <li >
                            <img  class="imgList" src="" url="" th:attr="src=${businessUser.bankCardFront}" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this);" class="btn">清除</a>

                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
        <tr id="enterpriseImage" >
            <td>
                <div class="control-group">
                    <label class="control-label">营业执照：</label>
                    <div class="controls">
                        <input id="licenseImage"  style="width:139px;" th:value="${businessUser.businessLicensePicture}" placeholder="请选择营业执照照片" axlength="255" class="input-xlarge required " readonly="readonly" type="text" value=""/>
                        <input type="file" id="file5" name="businessLicensePictureImg" style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="licenseImagePreview"> <li >
                            <img  class="imgList" src="" url="" th:attr="src=${businessUser.businessLicensePicture}" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this);" class="btn">清除</a>

                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">门头照：</label>
                    <div class="controls">
                        <input id="doorHeadImage"  style="width:139px;" th:value="${businessUser.doorPicture}" placeholder="请选择门头照照片" axlength="255" class="input-xlarge" readonly="readonly" type="text" value=""/>
                        <input type="file" id="file6" name="doorPictureImg" style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="doorHeadImagePreview"><li >
                            <img  class="imgList" src="" th:attr="src=${businessUser.doorPicture}" url="" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this)" class="btn">清除</a>

                        <!-- <span class="help-inline"><font color="red">*</font> </span> -->
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">开户许可证：</label>
                    <div class="controls">
                        <input id="accountLicence" th:value="${businessUser.registerLicensePicture}"  style="width:139px;" placeholder="请选择开户许可证" axlength="255" class="input-xlarge" readonly="readonly" type="text" value=""/>
                        <input type="file" id="file7" name="registerLicensePictureImg" style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
                        <ol id="accountLicencePreview"><li >
                            <img  class="imgList"  th:attr="src=${businessUser.registerLicensePicture}" src="" url="" style="max-width:100px;max-height:100px;_height:100px;border:0;padding:3px;">
                        </li></ol><a href="javascript:" onclick="addImg(this)" class="btn">选择</a>&nbsp;<a href="javascript:" onclick="clearImg(this)" class="btn">清除</a>

                        <span class="help-inline"><font color="red">*</font> </span>
                    </div>
                </div>
            </td>
        </tr>
    </table>


    <div id="auditInfo">

    </div>


    <div  class="form-actions" style="margin-left: 160px">
        <input id="btnSubmit" class="btn btn-primary" type="submit" value="保 存"/>&nbsp;
        <input id="btnCancel" class="btn" type="button" value="返 回" onclick="history.go(-1)"/>
    </div>
</form>
<script type="text/javascript">
    $(function(){
        $(".imgList").click(function(){
            window.top.dialog('img',$(this).attr("url"));
        });
    });
    $("input[type='file']").change(function () {
        var isFile = this.files[0];
        var file = $(this).val();

        var fileName = getFileName(file);
        $(this).prev().removeAttr("readonly");
        $(this).prev().val(fileName);
       var image=$(this);
        if (window.FileReader) {
            var reader = new FileReader();
            reader.readAsDataURL(isFile);
            //监听文件读取结束后事件
            reader.onloadend = function (e) {
                image.next().children().children().attr('src',e.target.result);
            };
        }


        $(this).prev().attr("readonly","readonly");
    })
    function getFileName(o){
        var pos=o.lastIndexOf("\\");
        return o.substring(pos+1);
    }
    function addImg(o){
        $(o).prevAll("input[type='file']").trigger('click');
    }
function clearImg(o){
        $(o).prevAll("input[type='text']").removeAttr("readonly");
        $(o).prevAll("input[type='text']").val("");
        $(o).prevAll("input[type='text']").attr("readonly","readonly");
        $(o).prevAll("input[type='file']").removeAttr("value");
        $(o).prevAll("ol").children().children().attr("src","");


}
    $("#provinceSel").change(function () {
       var areaCode= $(this).val();
       //$("#s2id_city1").children().children().get(0).html("--请选择市--");
       $.post("../TbAreaDictionary/findByAreaOde",{areaCode:areaCode},function(data){
           $("#city1").html("<option value='' selected='selected'>&#45;&#45;请选择市&#45;&#45;</option>")
           $("#district1").html("<option value='' selected='selected'>&#45;&#45;请选择区&#45;&#45;</option>")
            for (var i=0 ; i<data.length ; i++){
                var $option = "<option value='"+data[i].areaCode+"'>"+data[i].upAreaName+"</option>";
                $("#city1").append($option);
            }
       })
    })
    $("#city1").change(function () {
        var areaCode= $(this).val();
        $.post("../TbAreaDictionary/findByAreaOde",{areaCode:areaCode},function(data){
            $("#district1").html("<option value='' selected='selected'>&#45;&#45;请选择区&#45;&#45;</option>")
            for (var i=0 ; i<data.length ; i++){
                var $option = "<option value='"+data[i].areaCode+"'>"+data[i].upAreaName+"</option>";
                $("#district1").append($option);
            }
        })
    })
    $("#cardProvinceSel").change(function(){
        var areaName=$(this).val();
        $.post("../TbAreaDictionary/findByAreaName",{areaName:areaName},function(data){
            $("#cardCitySel").html("<option value=\"\">--请选择城市--</option>");
            for (var i=0 ; i<data.length ; i++ ){
             var $potion="<option value='"+data[i].upAreaName+"'>"+data[i].upAreaName+"</option>"
              $("#cardCitySel").append($potion)  ;
            }
        })
    })
</script>

<script id="auditRecordTemplate" type="text/html">
    {{if data && data.length>0}}
    <h6>审核记录</h6>
    <hr width="100%" style="border:1px solid #008fe2;"/>
    <table >
        {{each data as ac i}}
        <tr>
            <td>
                <div class="control-group" style="width: 391px">
                    <label class="control-label">审核人 ：</label>
                    <div class="controls">
                        <span>{{ac.auditBy}}</span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">操作/原因：</label>
                    <div class="controls">
                        <span>{{ac.auditRemark}}</span>
                    </div>
                </div>
            </td>
            <td>
                <div class="control-group">
                    <label class="control-label">审核时间：</label>
                    <div class="controls">
                        <span>{{ac.createTime}}</span>
                    </div>
                </div>
            </td>
        </tr>
        {{/each}}
    </table>
    {{/if}}
</script>
<script type="text/javascript">
    $(function(){
        $("#tabs").tabs();

        $.each($(".channelStatus"),function(index,data){
            /*  var index = $(this).attr("data-index");
             var sel_value = $(this).val();
             if(sel_value == 'Y'){
             $("#channelSetting-" + index).show();
             }else{
             $("#channelSetting-" + index).hide();
             } */
            var index = $(this).attr("data-index");
            var sel_value = $(this).val();
            var customerType=$("#customerTypeSel").val();
            var channelNum=$("#channelNum-" + index).val();

            var businessType=$("#businessTypeHidden-" + index).val();
            if(sel_value == 'Y'){
                /*初始化经营行业*/
                $.ajax({
                    type:"get",
                    url:"/a/operate/business/brcbBusinessType/getByType",
                    dataType : "json",
                    data: {customerType:customerType,channelType:channelNum},
                    success:function(data){
                        /* alert(data); */
                        $('#channelBusinessType-'+index).empty();
                        var $option = "<option code=''  value='' >--请选择经营行业--</option>";
                        $('#channelBusinessType-'+index).append($option);

                        $.each(data.business, function(i, item) {
                            /*  var $option = '<option label='+item.province+' value='+item.cityId+'>'+item.city+'</option>'; */
                            var $option = '<option type='+item.customerType+' value='+item.businessId+'>'+item.businessName+'</option>';
                            var $option = "<option type='"+item.customerType+"' value='"+item.businessId+"'>"+item.businessName+"</option>";
                            if(item.businessId==businessType){
                                $option = "<option type='"+item.customerType+"' selected='selected' value='"+item.businessId+"'>"+item.businessName+"</option>";
                                $("#s2id_channelBusinessType-"+index+" .select2-chosen").html(item.businessName);
                                /*  $option = '<option type='+item.customerType+' selected="selected" value='+item.businessId+'>'+item.businessName+'</option>'; */
                            }
                            $('#channelBusinessType-'+index).append($option);
                            $("#channelSetting-" + index).show();
                        });
                    }
                });
            }else{
                $("#channelSetting-" + index).hide();
            }

        });

        $.each($(".t0StatusSel"),function(index,data){
            var index = $(this).attr("data-index");
            var sel_value = $(this).val();
            if(sel_value == 'Y'){
                $("#settleModeSel-" + index).show();
            }else{
                $("#settleModeSel-" + index).hide();
            }
        });

        //通道 开通关闭事件
        $(".channelStatus").change(function(){
            var index = $(this).attr("data-index");
            var sel_value = $(this).val();
            var customerType=$("#customerTypeSel").val();
            var channelNum=$("#channelNum-" + index).val();
            if(sel_value == 'Y'){
                /*初始化经营行业*/
                $.ajax({
                    type:"get",
                    url:"/a/operate/business/brcbBusinessType/getByType",
                    dataType : "json",
                    data: {customerType:customerType,channelType:channelNum},
                    success:function(data){
                        $('#channelBusinessType-'+index).empty();
                        var $option = "<option code=''  value='' >--请选择经营行业--</option>";
                        $('#channelBusinessType-'+index).append($option);

                        $.each(data.business, function(i, item) {
                            /*  var $option = '<option label='+item.province+' value='+item.cityId+'>'+item.city+'</option>'; */
                            var $option = '<option type='+item.customerType+' value='+item.businessId+'>'+item.businessName+'</option>';
                            $('#channelBusinessType-'+index).append($option);
                            $("#channelSetting-" + index).show();
                        });
                    }
                });
            }else{
                $("#channelSetting-" + index).hide();
            }
        });

        //T0 开通关闭事件
        $(".t0StatusSel").change(function(){
            var index = $(this).attr("data-index");
            var sel_value = $(this).val();
            if(sel_value == 'Y'){
                $("#settleModeSel-" + index).show();
            }else{
                $("#settleModeSel-" + index).hide();
            }
        });

        // 检查上游通道开通及t0状态
        $.each($("select[class*='channelStatus']"),function(index,data){
            var agentNum = $("#agentNo").val();
            var index = $(this).attr("data-index");
            var channelNum =  $("#channelNum-"+index).val();
            var channelStatus = $(this).val();
            $.ajax({
                url:"/a/operate/customer/brcbCustomer/getAgentChannel",
                type:"get",
                dataType:"json",
                data:{
                    agentNum:agentNum,
                    channelNum:channelNum
                },
                success:function(res){
                    if(res == null){
                        $("#s2id_channelStatus-"+index+" .select2-chosen").html("不开通");
                        $("#channelStatus-" + index).val("N");
                        $("#channelStatus-" + index).attr("readonly","true");
                        $("#channelSetting-" + index).hide();
                        return;
                    }
                    if(res.isOpenChannel == "N"){
                        $("#s2id_channelStatus-"+index+" .select2-chosen").html("不开通");
                        $("#channelStatus-" + index).val("N");
                        $("#channelStatus-" + index).attr("readonly","true");
                        $("#channelSetting-" + index).hide();
                        return;
                    }
                    if(res.t0Status == "N"){
                        $("#s2id_t0StatusSel-"+index+" .select2-chosen").html("不开通");
                        $("#t0StatusSel-" + index).val("N");
                        $("#t0StatusSel-" + index).attr("readonly","true");
                        $("#settleModeSel-" + index).hide();
                        return;
                    }

                }
            })
        })

        /* 签约费率失去焦点事件*/
        $(".tradeFee").blur(function(){
            var agentNum = $("#agentNo").val();
            var fee = $(this).val();
            var index = $(this).attr("data-index");
            var channelNum = $("#channelNum-"+index).val();
            $.ajax({
                url:"/a/operate/agent/checkRate",
                type:"post",
                dataType:"json",
                data:{
                    agentNum:agentNum,
                    channelNum:channelNum
                },
                success:function(data){
                    if(data.success == 'true'){
                        var rate = data.agentFee.rate*100;
                        if(fee < rate){
                            $("#tradeFee_label_" + index).html("输入费率不能低于代理商签约费率！");
                            flag = false;
                        }else{
                            $("#tradeFee_label_" + index).html("");
                        }
                    }
                }
            });
        });

        /* T0费率失去焦点事件*/
        $(".settleFee").blur(function(){
            var agentNum = $("#agentNo").val();
            var fee = $(this).val();
            var index = $(this).attr("data-index");
            var channelNum = $("#channelNum-"+index).val();
            $.ajax({
                url:"/a/operate/agent/checkRate",
                type:"post",
                dataType:"json",
                data:{
                    agentNum:agentNum,
                    channelNum:channelNum
                },
                success:function(data){
                    if(data.success == 'true'){
                        var rate = data.agentSettleFee.settleRate*100;
                        if(fee < rate){
                            $("#settleFee_label_" + index).html("输入费率不能低于代理商T0费率！");
                            flag = false;
                        }else{
                            $("#settleFee_label_" + index).html("");
                        }
                    }
                }
            });
        });
        /* 单笔加收失去焦点事件*/
        $(".fixedFee").blur(function(){
            var agentNum = $("#agentNo").val();
            var fee = $(this).val();
            var index = $(this).attr("data-index");
            var channelNum = $("#channelNum-"+index).val();
            $.ajax({
                url:"/a/operate/agent/checkRate",
                type:"post",
                dataType:"json",
                data:{
                    agentNum:agentNum,
                    channelNum:channelNum
                },
                success:function(data){
                    if(data.success == 'true'){
                        var fixedFee = data.agentSettleFee.fixedFee;
                        if(fee*100 < fixedFee){
                            $("#fixedFee_label_" + index).html("单笔加收不能低于代理商单笔加收");
                            flag = false;
                        }else{
                            $("#fixedFee_label_" + index).html("");
                        }
                    }
                }
            });
        });



    })
    function checkSign(){
        var flag = true;
        $.each($("select[class*='channelStatus']"),function(index,data){
            var agentNum = $("#agentNo").val();
            var index = $(this).attr("data-index");
            var channelNum = $("#channelNum-"+index).val();
            var channelStatus = $(this).val();
            var fee = $("#tradeFee-"+index).val();
            var settleFee = $("#settleFee-"+index).val();
            var fixed = $("#fixedFee-"+index).val();
            var t0Status = $("#t0StatusSel-"+index).val();
            console.log("fee:"+fee);
            if(channelStatus == "Y"){
                //获取代理商签约费率
                $.ajax({
                    type:"post",
                    url:"/a/operate/agent/checkRate",
                    dataType : "json",
                    async: false,
                    data: {
                        agentNum:agentNum,
                        channelNum:channelNum
                    },
                    success:function(data){
                        if(data.success == 'true'){

                            var rate = data.agentFee.rate*100;
                            console.log("rate:"+rate);
                            if(fee < rate){
                                $("#tradeFee_label_" + index).html("输入费率不能低于代理商签约费率！");
                                flag = false;
                            }else{
                                $("#tradeFee_label_" + index).html("");
                            }
                            if(t0Status=="Y"){
                                var settleRate = data.agentSettleFee.settleRate*100;
                                var fixedFee = data.agentSettleFee.fixedFee;
                                if(settleFee < settleRate){
                                    $("#settleFee_label_" + index).html("输入费率不能低于代理商T0费率！");
                                    flag = false;
                                }else{
                                    $("#settleFee_label_" + index).html("");
                                }
                                if(fixed*100 < fixedFee){
                                    $("#fixedFee_label_" + index).html("单笔加收不能低于代理商单笔加收");
                                    flag = false;
                                }else{
                                    $("#fixedFee_label_" + index).html("");
                                }
                            }
                        }
                    }
                });
            }
        }) ;
        return flag;
    }

    $("#cardCitySel").change(function(){
        var bankName = $("#bankNameSel").val();
        var City=$("#cardCitySel").val();
        var Province = $("#cardProvinceSel").val();
        $.post("findByBankName",{bankName:bankName,city:City,province:Province},function(data){
                    $.each(data,function (i,bank) {
                        var $option="<option  value='"+bank.bankSubName+"'>"+bank.bankSubName+"</option>";
                        $("#cardBranchSel").append($option);
                    })
        })
    });

   $("#cardBranchSel").change(function () {
        var bankNo=$("#cardBranchSel").val();
        $("#bankNo").removeAttr('readonly');
        $.post("findBankNo",{bankSubName:bankNo},function (data) {
            $("#bankNo").val(data);
        })
       $("#bankNo").attr('readonly',"readonly");

    });
</script>
<script src="../../../static/address/distpicker.data.js"
th:src="@{../address/distpicker.data.js}"></script>
<script src="../../../static/address/distpicker.js"
th:src="@{../address/distpicker.js}"></script>
<script src="../../../static/address/main.js"
th:src="@{../address/main.js}"></script>

<script type="text/javascript">//<!-- 无框架时，左上角显示菜单图标按钮。
if(!(self.frameElement && self.frameElement.tagName=="IFRAME")){
    $("body").prepend("<i id=\"btnMenu\" class=\"icon-th-list\" style=\"cursor:pointer;float:right;margin:10px;\"></i><div id=\"menuContent\"></div>");
    $("#btnMenu").click(function(){
        top.$.jBox('get:/a/sys/menu/treeselect;JSESSIONID=584d7ca25b6a448aa0298fe8fc6bae77', {title:'选择菜单', buttons:{'关闭':true}, width:300, height: 350, top:10});
        //if ($("#menuContent").html()==""){$.get("/a/sys/menu/treeselect", function(data){$("#menuContent").html(data);});}else{$("#menuContent").toggle(100);}
    });
}//-->
</script>

<script>
    $("#channelStatus-1").click(function () {
        if($(this).children('option:selected').val()=='Y'  ){
            $("#channelSetting-1").show();
        }else {
            $("#channelSetting-1").hide();
        }
    })
    $("#channelStatus-3").click(function () {
        if($(this).children('option:selected').val()=='Y'  ){
            $("#channelSetting-3").show();
        }else {
            $("#channelSetting-3").hide();
        }
    })

    function toSubmit(){
        var $html = $("html input[readonly='readonly']");
        $html.removeAttr("readonly")
    }
    /*$(document).ready(function() {
        alert("123")
        var areaName = $("#cardProvinceSel").val();
        var bankCity = $("#bankCity").val();
        alert(bankCity)
        $.post("../TbAreaDictionary/findByAreaName", {areaName: areaName}, function (data) {
            $("#cardCitySel").html("<option value=''>--请选择城市--</option>")
            for (var i=0 ; i<data.length ; i++ ){
                if(bankCity==data[i].upAreaName){
                    var  $potion= "<option value='"+data[i].upAreaName+"' selected='selected'>"+data[i].upAreaName+"</option>"
                    $("#cardCitySel").append($potion)
                }else {
                var  $potion= "<option value='"+data[i].upAreaName+"'>"+data[i].upAreaName+"</option>"
                    $("#cardCitySel").append($potion)
                }
            }
        })
    })*/
</script>
</body>
</html>